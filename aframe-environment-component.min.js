function logPreset(){document.querySelector('[environment]').components.environment.logPreset()}AFRAME.registerComponent('environment',{schema:{preset:{default:'default',oneOf:['none','default','contact','egypt','checkerboard','forest','goaland','yavapai','threetowers','poison','starry','osiris','japan']},seed:{type:'int',default:1,min:0,max:1e3},skyType:{default:'color',oneOf:['color','gradient','atmosphere']},skyColor:{type:'color'},horizonColor:{type:'color'},lights:{default:'sun',oneOf:['none','sun','room']},lightPosition:{type:'vec3',default:{x:0,y:1,z:-0.2}},fog:{type:'float',default:0,min:0,max:1},flatShading:{default:!1},playArea:{type:'float',default:1,min:1,max:100},ground:{default:'hills',oneOf:['none','flat','hills','canyon','spikes','noise']},groundYScale:{type:'float',default:3,min:0,max:50},groundTexture:{default:'none',oneOf:['none','checkerboard','squares','noise','walkernoise']},groundColor:{type:'color',default:'#553e35'},groundColor2:{type:'color',default:'#694439'},dressing:{default:'none',oneOf:['none','cubes','pyramids','cylinders','towers','mushrooms','trees','apparatus','torii']},dressingAmount:{type:'int',default:10,min:0,max:1e3},dressingColor:{type:'color',default:'#795449'},dressingScale:{type:'float',default:5,min:0,max:100},dressingVariance:{type:'vec3',default:{x:1,y:1,z:1}},dressingUniformScale:{default:!0},grid:{default:'none',oneOf:['none','1x1','2x2','crosses','dots','xlines','ylines']},gridColor:{type:'color',default:'#ccc'}},presets:{none:{},'default':{seed:1,skyType:'atmosphere',skyColor:'#88c',horizonColor:'#ddd',lights:'sun',lightPosition:{x:-0.11,y:1,z:0.33},fog:0.78,flatShading:!1,playArea:1,ground:'hills',groundYScale:3,groundTexture:'checkerboard',groundColor:'#454545',groundColor2:'#5d5d5d',dressing:'none',dressingAmount:0,dressingColor:'#795449',dressingScale:1,dressingVariance:{x:0,y:0,z:0},dressingUniformScale:!0,grid:'none',gridColor:'#ccc'},contact:{seed:14,skyType:'gradient',skyColor:'#564b89',horizonColor:'#88c',lights:'sun',lightPosition:{x:0,y:2.01,z:-1},fog:0.74,flatShading:!1,ground:'spikes',groundYScale:3.26,groundTexture:'none',groundColor:'#473263',groundColor2:'#694439',dressing:'apparatus',dressingAmount:7,dressingColor:'#b6aaca',dressingScale:20,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,grid:'1x1',gridColor:'#a2869c'},egypt:{seed:26,skyType:'gradient',skyColor:'#1b7660',horizonColor:'#e4b676',lights:'sun',lightPosition:{x:0,y:1.65,z:-1},fog:0.75,flatShading:!1,playArea:1,ground:'hills',groundYScale:5,groundTexture:'walkernoise',groundColor:'#664735',groundColor2:'#6c4b39',dressing:'pyramids',dressingAmount:10,dressingColor:'#7c5c45',dressingScale:5,dressingVariance:{x:20,y:20,z:20},dressingUniformScale:!0,grid:'spots',gridColor:'#e4b676'},checkerboard:{seed:1,skyType:'gradient',skyColor:'#0d0d0d',horizonColor:'#404040',lights:'sun',lightPosition:{x:0,y:1,z:-0.2},fog:0.81,flatShading:!0,ground:'hills',groundYScale:4.81,groundTexture:'checkerboard',groundColor:'#252525',groundColor2:'#111111',dressing:'cubes',dressingAmount:10,dressingColor:'#9f9f9f',dressingScale:1.51,dressingVariance:{x:5,y:20,z:5},dressingUniformScale:!0,grid:'dots',gridColor:'#ccc'},forest:{seed:8,skyType:'gradient',skyColor:'#24b59f',horizonColor:'#eff9b7',lights:'sun',lightPosition:{x:-1.2,y:0.88,z:-0.55},fog:0.8,flatShading:!1,playArea:1,ground:'noise',groundYScale:4.18,groundTexture:'squares',groundColor:'#937a24',groundColor2:'#987d2e',dressing:'trees',dressingAmount:500,dressingColor:'#888b1d',dressingScale:1,dressingVariance:{x:10,y:10,z:10},dressingUniformScale:!0,grid:'none',gridColor:'#c5a543'},goaland:{seed:17,skyType:'gradient',skyColor:'#239893',horizonColor:'#a3dab8',lights:'room',lightPosition:{x:0.1,y:4,z:0.56},fog:0.73,flatShading:!1,playArea:1,ground:'noise',groundYScale:0.81,groundTexture:'none',groundColor:'#E95867',groundColor2:'#db4453',dressing:'mushrooms',dressingAmount:150,dressingColor:'#df5361',dressingScale:5,dressingVariance:{x:5,y:10,z:5},dressingUniformScale:!0,grid:'dots',gridColor:'#239893'},yavapai:{seed:11,skyType:'gradient',skyColor:'#239849',horizonColor:'#cfe0af',lights:'sun',lightPosition:{x:0.5,y:1,z:0},fog:0.8,flatShading:!1,playArea:1,ground:'canyon',groundYScale:9.76,groundTexture:'walkernoise',groundColor:'#C66344',groundColor2:'#c96b4b',dressing:'none',dressingAmount:50,dressingColor:'#dd7d44',dressingScale:5,dressingVariance:{x:5,y:10,z:5},dressingUniformScale:!0,grid:'none',gridColor:'#239893'},threetowers:{seed:5,skyType:'gradient',skyColor:'#23a06b',horizonColor:'#f5e170',lights:'sun',lightPosition:{x:0.5,y:1,z:0},fog:0.8,flatShading:!1,playArea:1,ground:'spikes',groundYScale:4.26,groundTexture:'walkernoise',groundColor:'#273a49',groundColor2:'#2b464f',dressing:'towers',dressingAmount:3,dressingColor:'#5f6d94',dressingScale:20,dressingVariance:{x:5,y:100,z:5},dressingUniformScale:!0,grid:'none',gridColor:'#239893'},poison:{seed:92,skyType:'gradient',skyColor:'#1ea84a',horizonColor:'#177132',lights:'sun',lightPosition:{x:0.5,y:1,z:0},fog:0.8,flatShading:!1,playArea:1,ground:'canyon',groundYScale:9.76,groundTexture:'none',groundColor:'#851f31',groundColor2:'#912235',dressing:'cubes',dressingAmount:20,dressingColor:'#c7415b',dressingScale:10,dressingVariance:{x:1,y:200,z:1},dressingUniformScale:!1,grid:'crosses',gridColor:'#de4e67'},starry:{seed:1,skyType:'atmosphere',skyColor:'#88c',horizonColor:'#ddd',lights:'sun',lightPosition:{x:0,y:-0.01,z:-0.46},fog:0.7,flatShading:!1,ground:'hills',groundYScale:3,groundTexture:'none',groundColor:'#553e35',groundColor2:'#694439',dressing:'none',dressingAmount:100,dressingColor:'#795449',dressingScale:5,dressingVariance:{x:1,y:1,z:1},dressingUniformScale:!0,grid:'1x1',gridColor:'#283133'},osiris:{seed:46,skyType:'atmosphere',skyColor:'#88c',horizonColor:'#ddd',lights:'sun',lightPosition:{x:0,y:0.02,z:-0.46},fog:0,flatShading:!1,ground:'hills',groundYScale:3,groundTexture:'none',groundColor:'#9e7b47',groundColor2:'#9e7b47',dressing:'pyramids',dressingAmount:7,dressingColor:'#9e7b47',dressingScale:5,dressingVariance:{x:30,y:30,z:30},dressingUniformScale:!0,grid:'dots',gridColor:'#4b779a'},japan:{seed:14,skyType:'gradient',skyColor:'#7e5db5',horizonColor:'#cabdf5',lights:'sun',lightPosition:{x:0.85,y:1,z:1},fog:0.8,flatShading:!1,playArea:1,ground:'hills',groundYScale:10,groundTexture:'walkernoise',groundColor:'#7e5db5',groundColor2:'#cabdf5',dressing:'torii',dressingAmount:4,dressingColor:'#bc5e7c',dressingScale:15,dressingVariance:{x:0,y:0,z:0},dressingUniformScale:!0,grid:'spots',gridColor:'#e4b676'}},init:function(){for(i in this.STAGE_SIZE=200,this.assets={stones:[{type:'mesh',vertices:[-148,-453,-18,142,-196,-26,-40,124,-109,36,-835,37,-282,-72,97,-40,-158,170,2,125,87,-174,125,-20,-65,-356,42,83,-555,-147,5,-182,-62,172,123,-12,193,-489,-60,4,-727,97,120,-767,16,39,-704,-88,-27,-801,-16,-16,-211,30,-119,-327,-8,-139,-349,93,213,124,-213,89,-589,-87,-229,-235,122,54,-537,-57,-173,124,11,28,124,-224,-176,124,205,107,-107,41,34,-21,167,110,-52,195,213,-124,88,161,-173,126,232,122,44,99,-202,87,74,-165,152,80,122,48,181,123,188,-99,-410,-79,-104,-690,-14,138,124,2,121,-356,-83,-301,124,113,-223,-282,20,-232,-62,192,151,-230,-208,-17,125,-106,222,-436,-100,50,-276,-211,165,-154,47,23,124,148,253,122,132,-131,124,-79,-110,124,101,-130,-633,81,100,124,-79,104,-713,-56,100,124,83,113,-468,87,-256,124,22,-270,124,194,-117,-265,164,-31,124,-7,-32,-175,-16,-34,124,157,-47,-289,130,128,124,-266,1,-500,-128,265,124,-100,269,-228,-74,89,123,6,113,-404,-7,168,121,7,34,-149,107,95,122,217],faces:[0,37,38,53,13,52,1,54,39,13,16,3,16,14,3,14,13,3,4,58,42,4,59,41,5,17,6,6,63,5,19,18,8,9,66,47,47,44,9,10,45,66,10,69,45,11,69,70,70,68,11,68,46,20,1,57,14,14,55,1,2,40,15,15,37,2,38,15,16,17,64,8,7,62,18,18,42,7,19,64,60,60,22,19,12,23,21,23,9,21,9,12,21,68,70,12,22,60,43,43,4,22,70,10,23,0,53,24,24,51,0,47,66,25,25,65,47,26,59,43,43,5,26,27,48,33,28,49,72,28,73,49,31,48,30,30,48,32,32,50,30,31,34,33,34,31,29,29,28,34,27,72,35,35,71,27,29,50,36,36,73,29,0,38,53,0,51,37,52,13,56,1,39,56,1,55,40,1,40,54,2,37,51,13,53,16,16,55,14,14,57,13,4,41,58,5,60,64,5,64,17,6,17,61,7,42,58,8,64,19,19,42,18,18,62,8,9,44,46,47,65,44,11,68,67,20,67,68,46,68,12,57,56,13,1,56,57,2,54,40,15,40,55,16,53,38,38,37,15,15,55,16,17,8,62,62,61,17,7,61,62,19,22,42,20,46,44,20,44,65,12,70,23,23,66,9,9,46,12,22,4,42,43,59,4,23,10,66,70,69,10,24,53,52,25,66,45,26,5,63,43,60,5,27,33,72,27,71,48,30,50,31,32,48,71,33,34,72,33,48,31,34,28,72,29,73,28,35,72,49,29,31,50]}],torii:[{type:'mesh',vertices:[692,966,-52,661,834,-52,692,966,52,661,834,52,518,935,52,345,913,52,170,899,52,162,779,52,328,790,52,494,808,52,170,899,-52,345,913,-52,518,935,-52,494,808,-52,328,790,-52,162,779,-52,586,618,16,586,697,16,586,618,-16,586,697,-16,331,-29,-75,331,766,-52,369,-29,-65,357,766,-45,396,-29,-37,377,766,-26,406,-29,0,384,766,0,396,-29,37,377,766,26,369,-29,65,357,766,45,331,-29,75,331,766,52,294,-29,65,305,766,45,267,-29,37,286,766,26,257,-29,0,279,766,0,267,-29,-37,286,766,-26,294,-29,-65,305,766,-45,333,762,-75,333,806,-75,371,762,-65,371,806,-65,398,762,-37,398,806,-37,408,762,0,408,806,0,398,762,37,398,806,37,371,762,65,371,806,65,333,762,75,333,806,75,296,762,65,296,806,65,268,762,37,268,806,37,258,762,0,258,806,0,268,762,-37,268,806,-37,296,762,-65,296,806,-65,52,681,33,52,777,85,52,681,-33,52,777,-85,-692,966,-52,-661,834,-52,-692,966,52,-661,834,52,0,894,-52,0,776,-52,0,894,52,0,776,52,-518,935,52,-345,913,52,-170,899,52,-162,779,52,-328,790,52,-494,808,52,-170,899,-52,-345,913,-52,-518,935,-52,-494,808,-52,-328,790,-52,-162,779,-52,0,618,16,0,697,16,0,618,-16,0,697,-16,-586,618,16,-586,697,16,-586,618,-16,-586,697,-16,-331,-29,-75,-331,766,-52,-369,-29,-65,-357,766,-45,-396,-29,-37,-377,766,-26,-406,-29,0,-384,766,0,-396,-29,37,-377,766,26,-369,-29,65,-357,766,45,-331,-29,75,-331,766,52,-294,-29,65,-305,766,45,-267,-29,37,-286,766,26,-257,-29,0,-279,766,0,-267,-29,-37,-286,766,-26,-294,-29,-65,-305,766,-45,0,777,85,0,681,33,-333,762,-75,-333,806,-75,-371,762,-65,-371,806,-65,-398,762,-37,-398,806,-37,-408,762,0,-408,806,0,-398,762,37,-398,806,37,-371,762,65,-371,806,65,-333,762,75,-333,806,75,-296,762,65,-296,806,65,-268,762,37,-268,806,37,-258,762,0,-258,806,0,-268,762,-37,-268,806,-37,-296,762,-65,-296,806,-65,0,681,-33,0,777,-85,-52,681,33,-52,777,85,-52,681,-33,-52,777,-85],faces:[76,6,10,1,9,13,7,78,79,0,3,1,12,1,13,76,15,77,10,14,15,11,13,14,3,4,9,9,5,8,8,6,7,15,79,77,15,8,7,14,9,8,12,2,0,11,4,12,10,5,11,95,18,94,19,16,18,17,92,16,18,92,94,95,17,19,21,22,20,23,24,22,25,26,24,27,28,26,29,30,28,31,32,30,33,34,32,35,36,34,37,38,36,39,40,38,41,42,40,43,20,42,45,46,44,47,48,46,49,50,48,51,52,50,53,54,52,151,69,71,55,56,54,70,125,150,57,58,56,69,125,68,59,60,58,71,68,70,61,62,60,151,70,150,63,64,62,65,53,49,65,66,64,67,44,66,50,58,66,82,76,86,85,73,89,83,78,82,75,72,73,73,88,89,91,76,77,90,86,91,89,87,90,75,80,74,85,81,80,84,82,81,79,91,77,91,84,90,90,85,89,74,88,72,80,87,88,81,86,87,98,95,94,96,99,98,92,97,96,92,98,94,97,95,99,102,101,100,104,103,102,106,105,104,108,107,106,110,109,108,112,111,110,114,113,112,116,115,114,118,117,116,120,119,118,122,121,120,100,123,122,128,127,126,130,129,128,132,131,130,134,133,132,136,135,134,153,151,155,138,137,136,125,154,150,140,139,138,125,153,152,142,141,140,152,155,154,144,143,142,154,151,150,146,145,144,135,143,131,148,147,146,126,149,148,140,136,128,76,78,6,1,3,9,7,6,78,0,2,3,12,0,1,76,10,15,10,11,14,11,12,13,3,2,4,9,4,5,8,5,6,15,7,79,15,14,8,14,13,9,12,4,2,11,5,4,10,6,5,95,19,18,19,17,16,17,93,92,18,16,92,95,93,17,21,23,22,23,25,24,25,27,26,27,29,28,29,31,30,31,33,32,33,35,34,35,37,36,37,39,38,39,41,40,41,43,42,43,21,20,45,47,46,47,49,48,49,51,50,51,53,52,53,55,54,151,124,69,55,57,56,70,68,125,57,59,58,69,124,125,59,61,60,71,69,68,61,63,62,151,71,70,63,65,64,49,47,45,45,67,65,65,63,61,61,59,65,57,55,53,53,51,49,49,45,65,65,59,57,57,53,65,65,67,66,67,45,44,66,44,46,46,48,66,50,52,58,54,56,58,58,60,62,62,64,58,66,48,50,52,54,58,58,64,66,82,78,76,85,75,73,83,79,78,75,74,72,73,72,88,91,86,76,90,87,86,89,88,87,75,85,80,85,84,81,84,83,82,79,83,91,91,83,84,90,84,85,74,80,88,80,81,87,81,82,86,98,99,95,96,97,99,92,93,97,92,96,98,97,93,95,102,103,101,104,105,103,106,107,105,108,109,107,110,111,109,112,113,111,114,115,113,116,117,115,118,119,117,120,121,119,122,123,121,100,101,123,128,129,127,130,131,129,132,133,131,134,135,133,136,137,135,153,124,151,138,139,137,125,152,154,140,141,139,125,124,153,142,143,141,152,153,155,144,145,143,154,155,151,146,147,145,127,129,131,131,133,135,135,137,139,139,141,135,143,145,147,147,149,127,127,131,143,135,141,143,143,147,127,148,149,147,126,127,149,128,126,148,148,146,128,144,142,140,140,138,136,136,134,132,132,130,136,128,146,144,144,140,128,136,130,128]}],towers:[{type:'extrude',vertices:[-0.054,-0.178,-0.007,-0.182,0.069,-0.027,0.189,0.079,0.178,0.124,-0.007,0.097,-0.145,0.182,-0.178,0.144,-0.079,-0.021]},{type:'lathe',segments:4,vertices:[0.004,0.02,0.012,0.092,0.042,0.166,0.067,0.55,0.101,0.594,0.105,0.838,0.193,0.934,0.18,0.994]},{type:'lathe',segments:5,vertices:[0.069,0.216,0.067,0.562,0.126,0.562,0.128,0.774,0.191,0.774,0.193,0.986]}],trees:[{type:'lathe',noise:0.015,segments:6,vertices:[0.004,0.826,0.054,0.832,0.105,0.854,0.136,0.9,0.136,0.958,0.118,0.994]},{type:'lathe',noise:0.015,segments:14,vertices:[0.004,0.01,0.069,0.022,0.13,0.068,0.178,0.18,0.189,0.32,0.191,0.59,0.193,0.75,0.138,0.79,0.018,0.808,0.018,0.996]},{type:'lathe',noise:0.015,segments:14,vertices:[0.002,0.436,0.126,0.46,0.201,0.57,0.219,0.72,0.154,0.846,0.028,0.884,0.034,0.996]}],apparatus:[{type:'lathe',segments:10,vertices:[0.004,0.23,0.042,0.23,0.069,0.36,0.038,0.362,0.038,0.372,0.06,0.372,0.073,0.572,0.024,0.572,0.024,0.67,0.069,0.67,0.075,0.722,0.097,0.724,0.105,0.852,0.083,0.902,0.065,0.902,0.065,0.924,0.128,0.924,0.146,0.996]},{type:'lathe',segments:16,vertices:[0.001,0.232,0.229,0.182,0.486,0.07,0.356,0.182,0.213,0.242,0.154,0.242,0.144,0.262,0.178,0.262,0.126,0.314,0.04,0.328,0.038,0.374,0.058,0.374,0.071,0.408,0.026,0.406,0.03,0.42,0.091,0.418,0.034,0.496,0.01,0.498,0.03,0.506,0.014,0.998]}],mushrooms:[{type:'lathe',noise:0.02,segments:14,vertices:[0.001,0.006,0.13,0.018,0.341,0.084,0.437,0.144,0.492,0.234,0.484,0.246,0.276,0.232,0.107,0.284,0.046,0.346,0.062,0.852,0.097,0.956,0.166,0.998]},{type:'lathe',noise:0.02,segments:10,vertices:[0.001,0.562,0.091,0.572,0.172,0.61,0.223,0.666,0.256,0.74,0.258,0.806,0.246,0.824,0.062,0.826,0.065,0.948,0.097,0.998]},{type:'lathe',noise:0.02,segments:10,vertices:[0.001,0.768,0.099,0.772,0.219,0.802,0.306,0.844,0.352,0.886,0.352,0.908,0.118,0.904,0.107,0.93,0.115,0.966,0.14,0.996]}]},this.assets)for(var d,c=0;c<this.assets[i].length;c++)if(d=this.assets[i][c],'mesh'==d.type)for(var e=0,k=d.vertices.length;e<k;e++)d.vertices[e]/=1e3;this.sky=document.createElement('a-sky'),this.sky.setAttribute('radius',this.STAGE_SIZE),this.sky.setAttribute('theta-length',110),this.stars=null,this.groundMaterial=null,this.ground=document.createElement('a-entity'),this.ground.setAttribute('rotation','-90 0 0'),this.groundCanvas=null,this.groundTexture=null,this.groundMaterial=null,this.groundGeometry=null,this.dressing=document.createElement('a-entity'),this.gridCanvas=null,this.gridTexture=null,this.hemilight=document.createElement('a-entity'),this.hemilight.setAttribute('position','0 50 0'),this.hemilight.setAttribute('light',{type:'hemisphere',color:'#CEE4F0',intensity:0.4}),this.sunlight=document.createElement('a-entity'),this.sunlight.setAttribute('position',this.data.lightPosition),this.sunlight.setAttribute('light',{intensity:0.6}),this.el.appendChild(this.hemilight),this.el.appendChild(this.sunlight),this.el.appendChild(this.ground),this.el.appendChild(this.dressing),this.el.appendChild(this.sky)},getFogColor:function(c,d){var e;if('color'==c)e=new THREE.Color(this.data.skyColor);else if('gradient'==c)e=new THREE.Color(this.data.horizonColor);else if('atmosphere'==c){var k=[1,0.5,0.22,0.1,0.05,0],m=['#C0CDCF','#81ADC5','#525e62','#2a2d2d','#141616','#000'];if(0>=d)return'#000';d=Math.min(1,d);for(var o=0;o<k.length;o++)if(d>k[o]){var p=new THREE.Color(m[o-1]),q=new THREE.Color(m[o]),A=(d-k[o])/(k[o-1]-k[o]);q.lerp(p,A),e=q;break}}return e.multiplyScalar(0.9),e.lerp(new THREE.Color(this.data.groundColor),0.3),'#'+e.getHexString()},update:function(c){if(void 0===c.preset||c.preset!==this.data.preset)return void this.el.setAttribute('environment',this.presets[this.data.preset]);var d=this.data.skyType,e=new THREE.Vector3(this.data.lightPosition.x,this.data.lightPosition.y,this.data.lightPosition.z);if(e.normalize(),this.sunlight)if(this.sunlight.setAttribute('position',this.data.lightPosition),'atmosphere'!=d){var k=new THREE.Color(this.data.skyColor);k.r=(k.r+1)/2,k.g=(k.g+1)/2,k.b=(k.b+1)/2,this.hemilight.setAttribute('light',{color:'#'+k.getHexString()}),this.sunlight.setAttribute('light',{intensity:0.6}),this.hemilight.setAttribute('light',{intensity:0.6})}else this.sunlight.setAttribute('light',{intensity:0.1+0.5*e.y}),this.hemilight.setAttribute('light',{intensity:0.1+0.5*e.y});if(d!=c.skyType||this.data.skyColor!=c.skyColor||this.data.horizonColor!=c.horizonColor){var m={};d!=c.skyType&&(m.shader={color:'flat',gradient:'gradientshader',atmosphere:'skyshader'}[d],this.stars&&this.stars.setAttribute('visible','atmosphere'==d)),'color'==d?(m.color=this.data.skyColor,m.fog=!1):'gradient'==d?(m.topColor=this.data.skyColor,m.bottomColor=this.data.horizonColor):'atmosphere'==d,this.sky.setAttribute('material',m)}'atmosphere'==d&&(this.sky.setAttribute('material',{sunPosition:e}),this.setStars(2e3*(1-Math.max(0,8*(e.y+0.08))))),0<this.data.fog?this.el.sceneEl.setAttribute('fog',{color:this.getFogColor(d,e.y),far:2*((1.01-this.data.fog)*this.STAGE_SIZE)}):this.el.sceneEl.removeAttribute('fog'),this.data.lights!==c.lights&&(this.sunlight.setAttribute('light',{type:'room'==this.data.lights?'point':'directional'}),this.sunlight.setAttribute('visible','none'!==this.data.lights),this.hemilight.setAttribute('visible','none'!==this.data.lights));var o=!this.groundGeometry||this.data.seed!=c.seed||this.data.ground!=c.ground||this.data.playArea!=c.playArea||this.data.flatShading!=c.flatShading;(o||this.data.groundColor!=c.groundColor||this.data.groundColor2!=c.groundColor2||this.data.groundYScale!=c.groundYScale||this.data.groundTexture!=c.groundTexture||this.data.gridColor!=c.gridColor||this.data.grid!=c.grid)&&(this.updateGround(o),this.hemilight&&this.hemilight.setAttribute('light',{groundColor:this.data.groundColor})),(this.data.seed!=c.seed||this.data.dressing!=c.dressing||this.data.flatShading!=c.flatShading||this.data.dressingAmount!=c.dressingAmount||this.data.dressingScale!=c.dressingScale||this.data.dressingColor!=c.dressingColor||this.data.dressingVariance.x!=c.dressingVariance.x||this.data.dressingVariance.y!=c.dressingVariance.y||this.data.dressingVariance.z!=c.dressingVariance.z||this.data.dressingUniformScale!=c.dressingUniformScale)&&this.updateDressing(),this.dumpParametersDiff()},logPreset:function(){var c='{';for(var d in this.schema)if('preset'!=d){c+=d+': ';var e=this.schema[d].type;c+='vec3'==e?'{ x: '+this.data[d].x+', y: '+this.data[d].y+', z: '+this.data[d].z+'}':'string'==e||'color'==e?'"'+this.data[d]+'"':this.data[d],c+=', '}c+='}',console.log(c)},dumpParametersDiff:function(){var c=A=>Math.floor(1e3*A)/1e3,d=[],e='none'!=this.data.preset&&this.presets[this.data.preset];for(var k in e&&d.push('preset: '+this.data.preset),this.schema)if(!('preset'==k||e&&void 0===e[k])){var m=e?e[k]:this.schema[k].default,o=this.data[k],p=this.schema[k].type;if('vec3'==p){var q=m;'string'==typeof m&&(m=m.split(' '),q={x:m[0],y:m[1],z:m[2]}),(c(q.x)!=c(o.x)||c(q.y)!=c(o.y)||c(q.z)!=c(o.z))&&d.push(k+': '+c(o.x)+' '+c(o.y)+' '+c(o.z))}else m!=o&&('number'==this.schema[k].type&&(o=c(o)),d.push(k+': '+o))}console.log('%c'+d.join('; '),'color: #f48;font-weight:bold')},random:function(c){return parseFloat('0.'+Math.sin(9999*this.data.seed*c).toString().substr(7))},updateGround:function(c){var d=64;if(c){var e='none'!=this.data.ground;if(this.ground.setAttribute('visible',e),!e)return;this.groundGeometry||(this.groundGeometry=new THREE.PlaneGeometry(this.STAGE_SIZE+2,this.STAGE_SIZE+2,d-1,d-1));for(var k=new PerlinNoise,m=this.groundGeometry.vertices,o=this.groundGeometry.vertices.length,p=10,q=p/d,A=0,C=0,D=0;A<o;A++){if('flat'==this.data.ground){m[A].z=0;continue}var E;switch(this.data.ground){case'hills':E=Math.max(0,k.noise(C,D,0));break;case'canyon':E=0.2+0.8*k.noise(C,D,0),E=Math.min(1,10*Math.pow(E,2));break;case'spikes':E=0.02>this.random(A)?this.random(A+1):0;break;case'noise':E=0.35>this.random(A)?this.random(A+1):0;}E+=0.1*this.random(A+2),C+=q,10<=C&&(C=0,D+=q);var F=2*C/p-1,G=2*D/p-1,H=this.data.playArea;F=Math.max(0,Math.min(1,(Math.abs(F)-(H-0.9))*(1/H))),G=Math.max(0,Math.min(1,(Math.abs(G)-(H-0.9))*(1/H))),E*=F>G?F:G,m[A].z=E}this.groundGeometry.computeFaceNormals(),this.data.flatShading?this.groundGeometry.computeFlatVertexNormals():this.groundGeometry.computeVertexNormals(),this.groundGeometry.verticesNeedUpdate=!0,this.groundGeometry.facesNeedUpdate=!0,this.groundGeometry.normalsNeedUpdate=!0}this.ground.setAttribute('scale',{z:this.data.groundYScale});var I=2048,J=20,K=this.STAGE_SIZE/J;this.groundCanvas&&this.groundCanvas.width==I||(this.gridCanvas=document.createElement('canvas'),this.gridCanvas.width=I,this.gridCanvas.height=I,this.gridTexture=new THREE.Texture(this.gridCanvas),this.gridTexture.wrapS=THREE.RepeatWrapping,this.gridTexture.wrapT=THREE.RepeatWrapping,this.gridTexture.repeat.set(K,K),this.groundCanvas=document.createElement('canvas'),this.groundCanvas.width=I,this.groundCanvas.height=I,this.groundTexture=new THREE.Texture(this.groundCanvas),this.groundTexture.wrapS=THREE.RepeatWrapping,this.groundTexture.wrapT=THREE.RepeatWrapping,this.groundTexture.repeat.set(K,K),this.groundMaterial=new THREE.MeshLambertMaterial({map:this.groundTexture,emissive:new THREE.Color(16777215),emissiveMap:this.gridTexture,wireframe:!1,shading:this.data.flatShading?THREE.FlatShading:THREE.SmoothShading}));var L=this.groundCanvas.getContext('2d'),M=this.gridCanvas.getContext('2d');if(this.drawTexture(L,I,J),M.fillStyle='#000000',M.fillRect(0,0,I,I),this.drawGrid(M,I,J),this.groundTexture.needsUpdate=!0,this.gridTexture.needsUpdate=!0,c){var N=new THREE.Mesh(this.groundGeometry,this.groundMaterial);this.ground.setObject3D('mesh',N)}else this.ground.getObject3D('mesh').material=this.groundMaterial},drawGrid:function(c,d,e){if('none'!=this.data.grid){var k=Math.floor(e/2),m=d/(e/2);switch(c.fillStyle=this.data.gridColor,this.data.grid){case'1x1':case'2x2':'1x1'==this.data.grid&&(k*=2,m=d/e);for(var p,o=0;o<k;o++)p=Math.floor(o*m),c.fillRect(0,p,d,1),c.fillRect(p,0,1,d);break;case'crosses':for(var p,q=Math.floor(m/20),o=0;o<k+1;o++){p=Math.floor(o*m);for(var B,A=0;A<k+1;A++)B=Math.floor(-q+A*m),c.fillRect(B,p,2*q,1),c.fillRect(p,B,1,2*q)}break;case'dots':for(var o=0;o<k+1;o++)for(var A=0;A<k+1;A++)c.beginPath(),c.arc(Math.floor(A*m),Math.floor(o*m),4,0,2*Math.PI),c.fill();break;case'xlines':for(var o=0;o<k;o++)c.fillRect(Math.floor(o*m),0,1,d);break;case'ylines':for(var o=0;o<k;o++)c.fillRect(0,Math.floor(o*m),d,1);}}},drawTexture:function(c,d,e){if(c.fillStyle=this.data.groundColor,c.fillRect(0,0,d,d),'none'!=this.data.groundTexture)switch(this.data.groundTexture){case'checkerboard':c.fillStyle=this.data.groundColor2;for(var k=Math.floor(e/2),m=d/(e/2),o=0;o<k+1;o+=2)for(var p=0;p<k+1;p++)c.fillRect(Math.floor((o+p%2)*m),Math.floor(p*m),Math.floor(m),Math.floor(m));break;case'squares':for(var D,q=16,A=d/q,B=new THREE.Color(this.data.groundColor),C=new THREE.Color(this.data.groundColor2),o=0;o<q*q;o++)D=0.5<this.random(o+3)?B.clone():C.clone(),D.addScalar(0.1*this.random(o+3)-0.05),c.fillStyle='#'+D.getHexString(),c.fillRect(o%q*A,Math.floor(o/q)*A,A,A);break;case'noise':for(var J,E=c.getImageData(0,0,d,d),F=E.data,B=new THREE.Color(this.data.groundColor),C=new THREE.Color(this.data.groundColor2),G=new THREE.Color(C.r-B.r,C.g-B.g,C.b-B.b),H=new PerlinNoise,o=0,p=0,I=F.length;o<I;o+=4,p++)J=H.noise(3*(p%d/d),3*(p/d/d),0),F[o+0]=Math.floor(255*(B.r+G.r*J)),F[o+1]=Math.floor(255*(B.g+G.g*J)),F[o+2]=Math.floor(255*(B.b+G.b*J));c.putImageData(E,0,0);break;case'walkernoise':var K=Math.floor(d/2),L=document.createElement('canvas');L.width=K,L.height=K;var M=L.getContext('2d');M.fillStyle=this.data.groundColor,M.fillRect(0,0,K,K);for(var D,E=M.getImageData(0,0,K,K),F=E.data,B=new THREE.Color(this.data.groundColor),C=new THREE.Color(this.data.groundColor2),N=[],O=1e3,o=0;o<O;o++)D=B.clone().lerp(C,Math.random()),N.push({x:Math.random()*K,y:Math.random()*K,r:Math.floor(255*D.r),g:Math.floor(255*D.g),b:Math.floor(255*D.b)});for(var Q=0;Q<5e3;Q++)for(var o=0;o<O;o++){var R=N[o],S=4*Math.floor(R.y*K+R.x);F[S+0]=R.r,F[S+1]=R.g,F[S+2]=R.b,R.x+=Math.floor(3*Math.random())-1,R.y+=Math.floor(3*Math.random())-1,R.x>=K&&(R.x-=K),R.y>=K&&(R.y-=K),0>R.x&&(R.x=K+R.x),0>R.y&&(R.y=K+R.y)}M.putImageData(E,0,0),c.drawImage(L,0,0,d,d);}},getAssetGeometry:function(c){function d(G,H){for(var I=new THREE.Vector3,J=0,K=G.vertices.length;J<K;J++)I.x=(k.random(J)-0.5)*H,I.y=(k.random(J+K)-0.5)*H,I.z=(k.random(J+2*K)-0.5)*H,G.vertices[J].add(I)}if(!c)return null;for(var e=[],k=this,m=0;m<c.length;m++)if('lathe'==c[m].type){for(var o=-99999,p=[],q=c[m].vertices,A=0;A<q.length;A+=2)p.push(new THREE.Vector2(q[A],q[A+1])),q[A+1]>o&&(o=q[A+1]);var B=new THREE.LatheGeometry(p,c[m].segments||8);B.applyMatrix(new THREE.Matrix4().makeRotationFromEuler(new THREE.Euler(-Math.PI,0,0))),B.applyMatrix(new THREE.Matrix4().makeTranslation(0,o,0)),c[m].noise&&d(B,c[m].noise),e.push(B)}else if('extrude'==c[m].type){for(var C=new THREE.Shape,q=c[m].vertices,A=0;A<q.length;A+=2)0==A?C.moveTo(q[A],q[A+1]):C.lineTo(q[A],q[A+1]);B=new THREE.ExtrudeGeometry(C,{amount:1,bevelEnabled:!1}),B.applyMatrix(new THREE.Matrix4().makeRotationFromEuler(new THREE.Euler(-Math.PI/2,0,0))),c[m].noise&&d(B,c[m].noise),e.push(B)}else if('mesh'==c[m].type){for(var B=new THREE.Geometry,q=c[m].vertices,D=c[m].faces,E=0;E<q.length;E+=3)B.vertices.push(new THREE.Vector3(q[E],q[E+1],q[E+2]));for(var F=0;F<D.length;F+=3)B.faces.push(new THREE.Face3(D[F],D[F+1],D[F+2]));B.computeFaceNormals(),c[m].noise&&d(B,c[m].noise),e.push(B)}return e},updateDressing:function(){var c=new THREE.Object3D;if(this.dressing.setAttribute('visible','none'!=this.data.dressing),'none'!=this.data.dressing){var m,d=new THREE.Geometry;switch(this.data.dressing){case'cubes':m=[new THREE.BoxGeometry(1,1,1)],m[0].applyMatrix(new THREE.Matrix4().makeTranslation(0,0.5,0));break;case'pyramids':m=[new THREE.ConeGeometry(1,1,4,1,!0)],m[0].applyMatrix(new THREE.Matrix4().makeTranslation(0,0.5,0));break;case'cylinders':m=[new THREE.CylinderGeometry(0.5,0.5,1,8,1,!0)],m[0].applyMatrix(new THREE.Matrix4().makeTranslation(0,0.5,0));break;default:if(m=this.getAssetGeometry(this.assets[this.data.dressing]),!m)return;}for(var o=0,p=88343;o<this.data.dressingAmount;o++,p++){var q=m[Math.floor(this.random(33+o)*m.length)],A=new THREE.Color(16777215).multiplyScalar(1-0.3*this.random(66+o)),B=this.data.dressingScale,C=new THREE.Vector3(this.data.dressingVariance.x,this.data.dressingVariance.y,this.data.dressingVariance.z),D=10+Math.max(C.x,C.z)+10*this.random(p+1)+this.random(p+2)*this.STAGE_SIZE/3,E=2*(this.random(p+3)*Math.PI),F=new THREE.Matrix4,G=this.random(p+4),H=this.data.dressingUniformScale;F.compose(new THREE.Vector3(Math.cos(E)*D,0,Math.sin(E)*D),new THREE.Quaternion().setFromAxisAngle(new THREE.Vector3(0,1,0),2*((this.random(p+5)-0.5)*C.length()*Math.PI)),new THREE.Vector3(B+(H?G:this.random(p+6))*C.x,B+(H?G:this.random(p+7))*C.y,B+(H?G:this.random(p+8))*C.z)),d.merge(q,F)}var I=new THREE.BufferGeometry;I.fromGeometry(d);var J=new THREE.MeshLambertMaterial({color:new THREE.Color(this.data.dressingColor),vertexColors:THREE.VertexColors});this.data.flatShading&&I.computeVertexNormals();var K=new THREE.Mesh(I,J);c.add(K),this.dressing.setObject3D('mesh',c)}},createStars:function(){for(var d=new THREE.BufferGeometry,e=new Float32Array(3*2e3),k=this.STAGE_SIZE/2-1,m=new THREE.Vector3,o=0;o<e.length;o+=3)m.set(this.random(o+23)-0.5,this.random(o+24),this.random(o+25)-0.5),m.normalize(),m.multiplyScalar(k),e[o]=m.x,e[o+1]=m.y,e[o+2]=m.z;d.addAttribute('position',new THREE.BufferAttribute(e,3)),d.setDrawRange(0,0);var p=new THREE.PointsMaterial({size:0.01,color:13421772,fog:!1});this.stars.setObject3D('mesh',new THREE.Points(d,p))},setStars:function(c){this.stars||(this.stars=document.createElement('a-entity'),this.stars.id='stars',this.createStars(),this.el.appendChild(this.stars)),c=Math.floor(Math.min(2e3,Math.max(0,c))),this.stars.getObject3D('mesh').geometry.setDrawRange(0,c)}}),AFRAME.registerShader('skyshader',{schema:{luminance:{type:'number',default:1,min:0,max:2,is:'uniform'},turbidity:{type:'number',default:2,min:0,max:20,is:'uniform'},reileigh:{type:'number',default:1,min:0,max:4,is:'uniform'},mieCoefficient:{type:'number',default:5e-3,min:0,max:0.1,is:'uniform'},mieDirectionalG:{type:'number',default:0.8,min:0,max:1,is:'uniform'},sunPosition:{type:'vec3',default:'0 0 -1',is:'uniform'},color:{type:'color',default:'#fff'}},vertexShader:['varying vec3 vWorldPosition;','void main() {','vec4 worldPosition = modelMatrix * vec4( position, 1.0 );','vWorldPosition = worldPosition.xyz;','gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );','}'].join('\n'),fragmentShader:['uniform sampler2D skySampler;','uniform vec3 sunPosition;','varying vec3 vWorldPosition;','vec3 cameraPos = vec3(0., 0., 0.);','uniform float luminance;','uniform float turbidity;','uniform float reileigh;','uniform float mieCoefficient;','uniform float mieDirectionalG;','// constants for atmospheric scattering','const float e = 2.71828182845904523536028747135266249775724709369995957;','const float pi = 3.141592653589793238462643383279502884197169;','const float n = 1.0003; // refractive index of air','const float N = 2.545E25; // number of molecules per unit volume for air at','// 288.15K and 1013mb (sea level -45 celsius)','const float pn = 0.035;  // depolatization factor for standard air','// wavelength of used primaries, according to preetham','const vec3 lambda = vec3(680E-9, 550E-9, 450E-9);','// mie stuff','// K coefficient for the primaries','const vec3 K = vec3(0.686, 0.678, 0.666);','const float v = 4.0;','// optical length at zenith for molecules','const float rayleighZenithLength = 8.4E3;','const float mieZenithLength = 1.25E3;','const vec3 up = vec3(0.0, 1.0, 0.0);','const float EE = 1000.0;','const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;','// 66 arc seconds -> degrees, and the cosine of that','// earth shadow hack','const float cutoffAngle = pi/1.95;','const float steepness = 1.5;','vec3 totalRayleigh(vec3 lambda)','{','return (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn));','}','// A simplied version of the total Rayleigh scattering to works on browsers that use ANGLE','vec3 simplifiedRayleigh()','{','return 0.0005 / vec3(94, 40, 18);','}','float rayleighPhase(float cosTheta)','{   ','return (3.0 / (16.0*pi)) * (1.0 + pow(cosTheta, 2.0));','}','vec3 totalMie(vec3 lambda, vec3 K, float T)','{','float c = (0.2 * T ) * 10E-18;','return 0.434 * c * pi * pow((2.0 * pi) / lambda, vec3(v - 2.0)) * K;','}','float hgPhase(float cosTheta, float g)','{','return (1.0 / (4.0*pi)) * ((1.0 - pow(g, 2.0)) / pow(1.0 - 2.0*g*cosTheta + pow(g, 2.0), 1.5));','}','float sunIntensity(float zenithAngleCos)','{','return EE * max(0.0, 1.0 - exp(-((cutoffAngle - acos(zenithAngleCos))/steepness)));','}','// Filmic ToneMapping http://filmicgames.com/archives/75','float A = 0.15;','float B = 0.50;','float C = 0.10;','float D = 0.20;','float E = 0.02;','float F = 0.30;','float W = 1000.0;','vec3 Uncharted2Tonemap(vec3 x)','{','return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;','}','void main() ','{','float sunfade = 1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);','float reileighCoefficient = reileigh - (1.0* (1.0-sunfade));','vec3 sunDirection = normalize(sunPosition);','float sunE = sunIntensity(dot(sunDirection, up));','// extinction (absorbtion + out scattering) ','// rayleigh coefficients','vec3 betaR = simplifiedRayleigh() * reileighCoefficient;','// mie coefficients','vec3 betaM = totalMie(lambda, K, turbidity) * mieCoefficient;','// optical length','// cutoff angle at 90 to avoid singularity in next formula.','float zenithAngle = acos(max(0.0, dot(up, normalize(vWorldPosition - cameraPos))));','float sR = rayleighZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));','float sM = mieZenithLength / (cos(zenithAngle) + 0.15 * pow(93.885 - ((zenithAngle * 180.0) / pi), -1.253));','// combined extinction factor  ','vec3 Fex = exp(-(betaR * sR + betaM * sM));','// in scattering','float cosTheta = dot(normalize(vWorldPosition - cameraPos), sunDirection);','float rPhase = rayleighPhase(cosTheta*0.5+0.5);','vec3 betaRTheta = betaR * rPhase;','float mPhase = hgPhase(cosTheta, mieDirectionalG);','vec3 betaMTheta = betaM * mPhase;','vec3 Lin = pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * (1.0 - Fex),vec3(1.5));','Lin *= mix(vec3(1.0),pow(sunE * ((betaRTheta + betaMTheta) / (betaR + betaM)) * Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up, sunDirection),5.0),0.0,1.0));','//nightsky','vec3 direction = normalize(vWorldPosition - cameraPos);','float theta = acos(direction.y); // elevation --> y-axis, [-pi/2, pi/2]','float phi = atan(direction.z, direction.x); // azimuth --> x-axis [-pi/2, pi/2]','vec2 uv = vec2(phi, theta) / vec2(2.0*pi, pi) + vec2(0.5, 0.0);','// vec3 L0 = texture2D(skySampler, uv).rgb+0.1 * Fex;','vec3 L0 = vec3(0.1) * Fex;','// composition + solar disc','float sundisk = smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);','L0 += (sunE * 19000.0 * Fex)*sundisk;','vec3 whiteScale = 1.0/Uncharted2Tonemap(vec3(W));','vec3 texColor = (Lin+L0);   ','texColor *= 0.04 ;','texColor += vec3(0.0,0.001,0.0025)*0.3;','float g_fMaxLuminance = 1.0;','float fLumScaled = 0.1 / luminance;     ','float fLumCompressed = (fLumScaled * (1.0 + (fLumScaled / (g_fMaxLuminance * g_fMaxLuminance)))) / (1.0 + fLumScaled); ','float ExposureBias = fLumCompressed;','vec3 curr = Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);','vec3 color = curr*whiteScale;','vec3 retColor = pow(color,vec3(1.0/(1.2+(1.2*sunfade))));','gl_FragColor.rgb = retColor;','gl_FragColor.a = 1.0;','}'].join('\n')}),AFRAME.registerShader('gradientshader',{schema:{topColor:{type:'color',default:'1 0 0',is:'uniform'},bottomColor:{type:'color',default:'0 0 1',is:'uniform'}},vertexShader:['varying vec3 vWorldPosition;','void main() {','vec4 worldPosition = modelMatrix * vec4( position, 1.0 );','vWorldPosition = worldPosition.xyz;','gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0 );','}'].join('\n'),fragmentShader:['uniform vec3 bottomColor;','uniform vec3 topColor;','uniform float offset;','varying vec3 vWorldPosition;','void main() {',' float h = normalize( vWorldPosition ).y;',' gl_FragColor = vec4( mix( bottomColor, topColor, max( pow( max(h, 0.0 ), 0.8 ), 0.0 ) ), 1.0 );','}'].join('\n')});var PerlinNoise=function(c){c==void 0&&(c=Math),this.grad3=[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]],this.p=[];for(var d=0;256>d;d++)this.p[d]=Math.floor(256*c.random(666));this.perm=[];for(var d=0;512>d;d++)this.perm[d]=this.p[255&d]};PerlinNoise.prototype.dot=function(c,d,e,k){return c[0]*d+c[1]*e+c[2]*k},PerlinNoise.prototype.mix=function(c,d,e){return(1-e)*c+e*d},PerlinNoise.prototype.fade=function(c){return c*c*c*(c*(6*c-15)+10)},PerlinNoise.prototype.noise=function(c,d,e){var k=Math.floor(c),m=Math.floor(d),o=Math.floor(e);c-=k,d-=m,e-=o,k&=255,m&=255,o&=255;var p=this.perm[k+this.perm[m+this.perm[o]]]%12,q=this.perm[k+this.perm[m+this.perm[o+1]]]%12,A=this.perm[k+this.perm[m+1+this.perm[o]]]%12,B=this.perm[k+this.perm[m+1+this.perm[o+1]]]%12,C=this.perm[k+1+this.perm[m+this.perm[o]]]%12,D=this.perm[k+1+this.perm[m+this.perm[o+1]]]%12,E=this.perm[k+1+this.perm[m+1+this.perm[o]]]%12,F=this.perm[k+1+this.perm[m+1+this.perm[o+1]]]%12,G=this.dot(this.grad3[p],c,d,e),H=this.dot(this.grad3[C],c-1,d,e),I=this.dot(this.grad3[A],c,d-1,e),J=this.dot(this.grad3[E],c-1,d-1,e),K=this.dot(this.grad3[q],c,d,e-1),L=this.dot(this.grad3[D],c-1,d,e-1),M=this.dot(this.grad3[B],c,d-1,e-1),N=this.dot(this.grad3[F],c-1,d-1,e-1),O=this.fade(c),P=this.fade(d),Q=this.fade(e),R=this.mix(G,H,O),S=this.mix(K,L,O),T=this.mix(I,J,O),U=this.mix(M,N,O),V=this.mix(R,T,P),W=this.mix(S,U,P),$=this.mix(V,W,Q);return $};